<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Search</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v=6) }}">
</head>
<body>
  <div class="card">
    <h2>Search for any item!</h2>

    <!-- Ana arama formu -->
    <form method="get" action="/">
      <input type="text" name="q" placeholder="" value="{{ query or '' }}">
      <button type="submit">Search</button>
    </form>

    {% if results is defined %}
      <!-- Ban words: sadece sonuç geldiyse görünsün -->
      <div style="margin-top:12px;">
        <form method="get" action="/">
          <!-- query'yi koru -->
          <input type="hidden" name="q" value="{{ query }}">
          <input type="text" name="ban" placeholder="ban words (e.g., kılıf kapak kalem)"
                 value="{{ ban or '' }}" style="width:100%; padding:10px; border:1px solid #dcdfe4; border-radius:10px;">
          <div style="margin-top:8px; display:flex; gap:8px;">
            <button type="submit">Apply Ban</button>
            {% if ban %}
              <a href="/?q={{ query | urlencode }}" style="line-height:36px; color:#666; text-decoration:none;">Clear Ban</a>
            {% endif %}
          </div>
        </form>

        {% if ban %}
          <div style="margin-top:8px; color:#666;">Active bans:
            {% for w in ban.split() %}
              <span style="display:inline-block; padding:4px 8px; border:1px solid #e5e7eb; border-radius:999px; margin-right:6px;">
                {{ w }}
              </span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div style="margin-top:16px;">
        {% if results %}
          <div style="margin-bottom:8px; color:#666;">
            Showing {{ results|length }} result{{ '' if results|length == 1 else 's' }} for:
            <strong>{{ query }}</strong>{% if ban %} &nbsp;after bans{% endif %}
          </div>
          <table style="width:100%; border-collapse: collapse;">
            <thead>
              <tr>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">#</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">Name</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">Price</th>
                <th style="text-align:left; padding:8px; border-bottom:1px solid #eee;">URL</th>
              </tr>
            </thead>
            <tbody>
              {% for p in results %}
              <tr>
                <td style="padding:8px; border-bottom:1px solid #f3f3f3;">{{ loop.index }}</td>
                <td style="padding:8px; border-bottom:1px solid #f3f3f3;">{{ p.name }}</td>
                <td style="padding:8px; border-bottom:1px solid #f3f3f3; white-space:nowrap;">{{ p.price_text }}</td>
                <td style="padding:8px; border-bottom:1px solid #f3f3f3;">
                  <a href="{{ p.url }}" target="_blank" rel="noopener">Open</a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div style="margin-top:8px; color:#a00;">No items found.</div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</body>
</html>